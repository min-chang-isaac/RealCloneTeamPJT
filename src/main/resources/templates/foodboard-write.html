<!DOCTYPE html>
<html xmlns:th = "http://www.thymeleaf.org">
	<head>
		<meta charset = "UTF-8">
		<meta name = "viewport" content = "width=device-width, initial-scale = 1.0">
		<title>æŠ•ç¨¿ä½œæˆ- FoodBoard</title>
		
		<!--Bootstrap CSS-->
		<link href = "https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
		<style>
					/* ì•± í˜•íƒœì˜ ì¤‘ì•™ ì •ë ¬ ë ˆì´ì•„ì›ƒ */
					.mobile-container {
					    max-width: 430px;    /* ìµœì‹  ì•„ì´í° í”„ë¡œ ë§¥ìŠ¤ ì •ë„ì˜ ë„ˆë¹„ */
					    margin: 0 auto;      /* í™”ë©´ ì¤‘ì•™ ì •ë ¬ */
					    min-height: 100vh;   /* ìµœì†Œ ë†’ì´ë¥¼ í™”ë©´ ì „ì²´ë¡œ */
					    background-color: #ffffff;
					    border-left: 1px solid #f0f0f0;
					    border-right: 1px solid #f0f0f0;
					    display: flex;
					    flex-direction: column;
					    padding: 0;          /* ë‚´ë¶€ ì—¬ë°± ì´ˆê¸°í™” */
					}

					/* ìŠ¤í¬ë¡¤ ì‹œ í—¤ë” ê³ ì • (ì„ íƒ ì‚¬í•­) */
					header {
					    position: sticky;
					    top: 0;
					    z-index: 1020;
					    width: 100%;
					}
					</style>	
	</head>
		<body>
			<div class = "container-fluid px-0">
				<div class="mobile-container">
				<form th:action="@{/board/write}" method="post">
				<!--ì£¼í™©ìƒ‰ í—¤ë” ë¶€ë¶„-->
				
				<header class = "d-flex justify-content-between align-items-center py-3 px-3"
						style = "background-color: #ffecd9; min-height: 85px;">
					<!--ë’¤ë¡œ ê°€ê¸° ë²„íŠ¼-->
					<a th:href = "@{/board}"
						class="d-inline-flex align-items-center" 
					   	style="cursor: pointer; font-size: 24px; text-decoration: none; color: black; line-height: 1;">ã€ˆ</a>
					<h5 class = "mb-0 fw-bold">æŠ•ç¨¿</h5>
					<button type="submit" class="btn p-0 fw-bold" style="font-size: 16px; color: black; border: none; background: none;">å®Œäº†</button>
		
				</header>
					
				
					
						
					<!--ì œëª©-->
					<div class = "mt-3 px-3">
						<input type = "text" name="title"
								class = "form-control border-0 fs-5"
								placeholder="ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›"><hr class="mt-1">
					</div>
					<!--ì§€ì—­ ì„ íƒ-->
					<div class = "mt-3 px-3">
						<div class = "border rounded p-3 bg-light border" style = "background-color: #f8f9fa;">
							<div class = "small mb-2 text-muted">ã‚¨ãƒªã‚¢ã‚’é¸æŠ</div>
							
							<div class = "d-flex gap-2 mb-2">
								<!--ì§€ë°© ì„ íƒ-->
								<select class = "form-select" id = "regionSelect" name="region">
									<option value="" selected disabled>åœ°æ–¹ã‚’é¸æŠ</option>
										<option value="åŒ—æµ·é“ãƒ»æ±åŒ—">åŒ—æµ·é“ãƒ»æ±åŒ—</option>
										<option value="é–¢æ±">é–¢æ±</option>	
									    <option value="ä¸­éƒ¨">ä¸­éƒ¨</option>
									    <option value="è¿‘ç•¿">è¿‘ç•¿</option>
									    <option value="ä¸­å›½ãƒ»å››å›½">ä¸­å›½ãƒ»å››å›½</option>
									    <option value="ä¹å·ãƒ»æ²–ç¸„">ä¹å·ãƒ»æ²–ç¸„</option>
									</select>
								
								<select class = "form-select" id = "prefectureSelect" name="prefecture">
									<option selected>éƒ½é“åºœçœŒ</option>
									</select>
						</div>
								<!--ê²½ê³  ë©”ì‹œì§€ -->
								<small class = "text-danger">â€» åœ°åŸŸã‚’é¸æŠã—ã¦ãã ã•ã„</small>
						</div>
						</div>		
							<!--ë³„ì  ì„ íƒ-->
							<div class = "mt-3 px-3">
								<div class = "border rounded p-3" style = "background-color: #f8f9fa;">
									<div class = "mb-2">è©•ä¾¡ã‚’é¸æŠ</div>	
									<div class = "d-flex gap-2">
										<span class = "star" style = "cursor:pointer; font-size: 24px;">â˜†</span>
										<span class = "star" style = "cursor:pointer; font-size: 24px;">â˜†</span>
										<span class = "star" style = "cursor:pointer; font-size: 24px;">â˜†</span>
										<span class = "star" style = "cursor:pointer; font-size: 24px;">â˜†</span>
										<span class = "star" style = "cursor:pointer; font-size: 24px;">â˜†</span>
										<input type="hidden" name="rating" id="ratingInput" value="0">	
									</div>
								</div>
										
							<div class = "mt-3 px-3">
								<textarea name="content" class = "form-control border"
											placeholder="å†…å®¹ã‚’å…¥åŠ›"
											rows="10" style="resize: none;"></textarea>
										</div>
										
										<!-- ì´ë¯¸ì§€ ì—…ë¡œë“œ ì˜ì—­ -->
										<div class="mt-3 px-3 mb-5">
										    <div class="border rounded p-3" style="background-color: #f8f9fa;">
										        <div class="mb-2">ç”»åƒã‚’è¿½åŠ </div>
										        
										        <!-- íŒŒì¼ ì„ íƒ ë²„íŠ¼ -->
										        <input type="file" 
										               id="imageInput" 
										               accept="image/*" 
										               capture="environment"
										               style="display: none;">
										        
										        <button type="button" 
										                class="btn btn-outline-secondary w-100 mb-2" 
										                onclick="document.getElementById('imageInput').click()">
										            ğŸ“· ç”»åƒã‚’é¸æŠ
										        </button>
										        
										        <!-- ë“œë˜ê·¸&ë“œë¡­ ì˜ì—­ -->
										        <div id="dropZone" 
										             class="border border-2 border-dashed rounded p-4 text-center"
										             style="cursor: pointer; background-color: white;">
										            <p class="mb-0 text-muted small">
														ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ— / è²¼ã‚Šä»˜ã‘ (Ctrl+V)
													</p>
												</div>
										        
										        <!-- ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° -->
										        <div id="imagePreview" style="display: none;" class="mt-3">
										            <img id="previewImg" class="w-100 rounded" style="max-height: 300px; object-fit: cover;">
										            <button type="button" class="btn btn-sm btn-danger mt-2" onclick="removeImage()">
										                ğŸ—‘ï¸ å‰Šé™¤
										            </button>
										        </div>
										        
										        <!-- ì‹¤ì œ ì „ì†¡ë  URL (hidden) -->
										        <input type="hidden" name="imageUrl" id="imageUrl">
										    </div>
										</div>
									</form> 
								</div> 
							</div>				
								
					  <!--Bootstrap JS-->
					   <script src = "https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
					   <script>
						const stars = document.querySelectorAll('.star');
						const ratingInput = document.getElementById('ratingInput');
						stars.forEach(function(star, index){
						            star.addEventListener('click', function(){
						                const rating = index + 1;
						                ratingInput.value = rating; 
						                stars.forEach(function(s){ s.textContent = 'â˜†'; });
						                for (let i = 0; i <= index ; i++){ stars[i].textContent = 'â˜…'; }
						            });
						        });
						
						const regionData = {
								'ã™ã¹ã¦': [],
								'åŒ—æµ·é“ãƒ»æ±åŒ—': ['åŒ—æµ·é“', 'é’æ£®çœŒ', 'å²©æ‰‹çœŒ', 'å®®åŸçœŒ', 'ç§‹ç”°çœŒ', 'å±±å½¢çœŒ', 'ç¦å³¶çœŒ'],
								'é–¢æ±': ['æ±äº¬éƒ½', 'ç¥å¥ˆå·çœŒ', 'åƒè‘‰çœŒ', 'åŸ¼ç‰çœŒ', 'èŒ¨åŸçœŒ', 'æ ƒæœ¨çœŒ', 'ç¾¤é¦¬çœŒ'],
								'ä¸­éƒ¨': ['æ„›çŸ¥çœŒ', 'é™å²¡çœŒ', 'å²é˜œçœŒ', 'ä¸‰é‡çœŒ', 'æ–°æ½ŸçœŒ', 'å¯Œå±±çœŒ', 'çŸ³å·çœŒ', 'ç¦äº•çœŒ', 'å±±æ¢¨çœŒ', 'é•·é‡çœŒ'],
								'è¿‘ç•¿': ['å¤§é˜ªåºœ', 'å…µåº«çœŒ', 'äº¬éƒ½åºœ', 'æ»‹è³€çœŒ', 'å¥ˆè‰¯çœŒ', 'å’Œæ­Œå±±çœŒ'],
								'ä¸­å›½ãƒ»å››å›½': ['é³¥å–çœŒ', 'å³¶æ ¹çœŒ', 'å²¡å±±çœŒ', 'åºƒå³¶çœŒ', 'å±±å£çœŒ', 'å¾³å³¶çœŒ', 'é¦™å·çœŒ', 'æ„›åª›çœŒ', 'é«˜çŸ¥çœŒ'],
								'ä¹å·ãƒ»æ²–ç¸„': ['ç¦å²¡çœŒ', 'ä½è³€çœŒ', 'é•·å´çœŒ', 'ç†Šæœ¬çœŒ', 'å¤§åˆ†çœŒ', 'å®®å´çœŒ', 'é¹¿å…å³¶çœŒ', 'æ²–ç¸„çœŒ']
							};
							
							const regionSelect = document.getElementById('regionSelect');
							const prefectureSelect = document.getElementById('prefectureSelect');
							
							regionSelect.addEventListener('change', function(){
								const selectedRegion = this.value;
								prefectureSelect.innerHTML = '<option value="" selected disabled>éƒ½é“åºœçœŒ</option>';
								const prefectures = regionData[selectedRegion];
								
								if(prefectures){
									prefectures.forEach(function(prefecture){
										const option = document.createElement('option');
										option.value = prefecture;
										option.textContent = prefecture; 
										prefectureSelect.appendChild(option);
										});
									}
							});
						</script>
						<script>
						    const imageInput = document.getElementById('imageInput');
						    const dropZone = document.getElementById('dropZone');
						    const imagePreview = document.getElementById('imagePreview');
						    const previewImg = document.getElementById('previewImg');
						    const imageUrl = document.getElementById('imageUrl');
						    
						    // íŒŒì¼ ì„ íƒ ì‹œ
						    imageInput.addEventListener('change', function(e) {
						        const file = e.target.files[0];
						        if (file) {
						            uploadImage(file);
						        }
						    });
						    
						    // ë“œë˜ê·¸ ì˜¤ë²„
						    dropZone.addEventListener('dragover', function(e) {
						        e.preventDefault();
						        dropZone.style.backgroundColor = '#e9ecef';
								dropZone.style.borderColor = '#ffc107';
						    });
						    
						    // ë“œë˜ê·¸ leave
						    dropZone.addEventListener('dragleave', function(e) {
						        e.preventDefault();
						        dropZone.style.backgroundColor = 'white';
								dropZone.style.borderColor = '#dee2e6';
							});
						    
						    // ë“œë¡­
						    dropZone.addEventListener('drop', function(e) {
						        e.preventDefault();
						        dropZone.style.backgroundColor = 'white';
								dropZone.style.borderColor = '#dee2e6';
						        
						        const file = e.dataTransfer.files[0];
						        if (file && file.type.startsWith('image/')) {
						            uploadImage(file);
						        } else {
						            alert('ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¯èƒ½ã§ã™');
						        }
						    });
						    
						    // ë¶™ì—¬ë„£ê¸° (Ctrl+V)
						    document.addEventListener('paste', function(e) {
						        const items = e.clipboardData.items;
						        for (let i = 0; i < items.length; i++) {
						            if (items[i].type.startsWith('image/')) {
						                const file = items[i].getAsFile();
						                uploadImage(file);
						                break;
						            }
						        }
						    });
						    
						    // ì´ë¯¸ì§€ ì—…ë¡œë“œ í•¨ìˆ˜
							function uploadImage(file) {
							        // íŒŒì¼ í¬ê¸° ì²´í¬ (10MB)
							        if (file.size > 10 * 1024 * 1024) {
							            alert('ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã¯10MBä»¥ä¸‹ã«ã—ã¦ãã ã•ã„');
							            return;
							        }
						        const formData = new FormData();
						        formData.append('file', file);
						        
						        // ë¡œë”© í‘œì‹œ
						        dropZone.innerHTML = '<p class="mb-0"><span class="spinner-border spinner-border-sm me-2"></span>ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­...</p>';
						        
						        fetch('/api/upload', {
						            method: 'POST',
						            body: formData
						        })
								.then(response => {
								            if (!response.ok) {
								                throw new Error('ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¤±æ•—');
								            }
								            return response.json();
								        })
						        .then(data => {
						            if (data.url) {
						                // ì„±ê³µ: ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
						                previewImg.src = data.url;
						                imageUrl.value = data.url;
						                imagePreview.style.display = 'block';
						                dropZone.style.display = 'none';
						            } else {
						                alert(data.error || 'ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¤±æ•—');
						                resetDropZone();
						            }
						        })
								.catch(error => {
								           alert('ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼: ' + error.message);
								           console.error('Upload error:', error);
								           resetDropZone();
								});
						    }
						    
						    // ì´ë¯¸ì§€ ì‚­ì œ
						    function removeImage() {
						        previewImg.src = '';
						        imageUrl.value = '';
								imageInput.value = '';
						        imagePreview.style.display = 'none';
						        dropZone.style.display = 'block';
						        resetDropZone();
						    }
						    
						    // ë“œë¡­ì¡´ ë¦¬ì…‹
							function resetDropZone() {
							       dropZone.style.backgroundColor = 'white';
							       dropZone.style.borderColor = '#dee2e6';
							       dropZone.innerHTML = `
							           <p class="mb-0 text-muted small">
							               ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ— / è²¼ã‚Šä»˜ã‘ (Ctrl+V)
							           </p>
							       `;
							   }
						</script>
						
				</body>
				</html>	