<!DOCTYPE html>
<html xmlns:th = "http://www.thymeleaf.org">
<head>
	<meta charset = "UTF-8">
	<meta name = "viewport" content = "width=device-width, initial-scale = 1.0">
	<title>FoodBoard</title>

	<!--Bootstrap CSS-->
	<link href = "https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

	<link rel = "stylesheet" th:href = "@{/css/foodboard.css}">
		
	<style>
		.dropdown-submenu:hover > .dropdown-menu {
			display: block;
		}
		/* ì•± í˜•íƒœì˜ ì¤‘ì•™ ì •ë ¬ ë ˆì´ì•„ì›ƒ */
		.mobile-container {
		    max-width: 430px;    /* ìµœì‹  ì•„ì´í° í”„ë¡œ ë§¥ìŠ¤ ì •ë„ì˜ ë„ˆë¹„ */
		    margin: 0 auto;      /* í™”ë©´ ì¤‘ì•™ ì •ë ¬ */
		    min-height: 100vh;   /* ìµœì†Œ ë†’ì´ë¥¼ í™”ë©´ ì „ì²´ë¡œ */
		    background-color: #ffffff;
		    border-left: 1px solid #f0f0f0;
		    border-right: 1px solid #f0f0f0;
		    display: flex;
		    flex-direction: column;
		    padding: 0;          /* ë‚´ë¶€ ì—¬ë°± ì´ˆê¸°í™” */
		}

		/* ìŠ¤í¬ë¡¤ ì‹œ í—¤ë” ê³ ì • (ì„ íƒ ì‚¬í•­) */
		header {
		    position: sticky;
		    top: 0;
		    z-index: 1020;
		    width: 100%;
		}
	</style>
</head>
<body>
	<div class="container-fluid px-0">
		<div class="mobile-container">
		<header class = "bg-white border-bottom py-3 px-3 d-flex justify-content-between align-items-center">
			<a th:href="@{/home}" 
			   class="d-inline-flex align-items-center justify-content-center" 
			   style="cursor: pointer; font-size: 24px; line-height: 1; width: 24px; height: 24px; text-decoration: none; color: black;">ã€ˆ</a>
			<div class="d-flex flex-column align-items-center dropdown">
			    <span class="fw-bold fs-4">ã‚°ãƒ«ãƒ¡æ²ç¤ºæ¿</span>
				<span class="small text-muted dropdown-toggle" 
				      id="categoryDisplay"
				      data-bs-toggle="dropdown" 
				      style="cursor: pointer" 
				      th:text="${currentCategory != null ? currentCategory : 'ã™ã¹ã¦'}">ã™ã¹ã¦</span>
			          
			    <ul class="dropdown-menu shadow border-0" id="regionDropdown">
			        <li><a class="dropdown-item" href="#" onclick="selectCategory('ã™ã¹ã¦')">ã™ã¹ã¦</a></li>
			        <li><hr class="dropdown-divider"></li>
			        </ul>
			</div>
			
			<div class="d-flex gap-3 align-items-center">
			    
			    
			    <div th:if="${session.loginUser != null}">
			        <div th:replace="~{logout :: logoutButton}">
			            <button class="btn btn-sm btn-outline-secondary">LOGOUT</button>
			        </div>
			    </div>

			    <div th:if="${session.loginUser == null}">
			        <a href="/login" class="btn btn-sm btn-outline-primary"
			           style="font-size: 0.8rem; border-radius: 20px; padding: 4px 12px; text-decoration:none; font-weight: 500;">
			           LOGIN
			        </a>
			    </div>
				<span id="searchIcon" style="cursor: pointer; font-size: 1.2rem;">ğŸ”</span>
			</div>
				<img src = "https://images.unsplash.com/photo-1740252117027-4275d3f84385?q=80&w=880&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" 
					class = "rounded-circle" 
					style = "width:32px; height:32px; cursor:pointer">
			</div>
	
		</header>
		
		<div id = "searchBar" class = "bg-white border-bottom p-3" style="display: none;">
			<div class = "input-group">
				<input type = "text"
						id = "searchInput"
						class = "form-control"
						placeholder = "æ¤œç´¢ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›">
					<button class = "btn btn-outline-secondary" id = "searchButton">æ¤œç´¢></button>
					<button class = "btn btn-outline-danger" id = "closeSearch">âŒ</button>
					</div>
				</div>

		<div class = "p-3 rounded d-flex gap-2 small fw-bold" style = "background-color: #ffecd9; cursor: pointer">
			<span>ğŸ“¢</span>
			<span>ã‚°ãƒ«ãƒ¡æ²ç¤ºæ¿ã”åˆ©ç”¨æ–¹æ³•ã¨ãƒ«ãƒ¼ãƒ«</span>
		</div>

		<main class="p-0 pb-5">
		    <div th:each="board : ${boards}" class="d-flex p-3 border-bottom" style="background-color: white">
		        <div class="flex-grow-1 pe-3" style="min-width: 0;">
		            <div class="small text-secondary mb-1" th:text="'[' + ${board.prefecture} + ']'">[æ±äº¬éƒ½]</div>
		            
		            <a th:href = "@{/board/view/{id}(id=${board.id})}"
						class = "text-decoration-none text-dark">
						<h6 class="fw-bold mb-1 text-truncate" style="cursor:pointer" th:text="${board.title}">ã‚¿ã‚¤ãƒˆãƒ«</h6>
		            
					<p class="small text-muted mb-2" 
					   th:text="${board.content}" 
					   style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; word-break: break-all;">
					   å†…å®¹...</p>

		            <div class="d-flex align-items-center gap-2 small">
		                <span class="text-warning" th:text="'â­' + ${board.rating}">â­5</span>
		                <span>â¤ï¸</span>
		                <span>ğŸ’¬</span>
		                <span class="ms-auto text-muted" th:text="${#temporals.format(board.createdAt, 'HH:mm')} + ' | ä½œæˆè€…'">12:24 | ä½œæˆè€…</span>
		            </div>
		        </div>

		        <div>
		            <img th:src="${board.imageUrl != null ? board.imageUrl : 'https://images.unsplash.com/photo-1529193591184-b1d58069ecdd?w=400'}"
		                 class="rounded"
		                 style="width: 80px; height: 80px; object-fit: cover">
		        </div>
		    </div>
		</main>

		<div class = "fixed-bottom d-flex justify-content-center mb-4">
		    <a th:href="@{/board/write}" class = "btn btn-primary rounded-pill shadow px-4 py-2 fw-bold text-decoration-none">
		        <span class = "me-2">æŠ•ç¨¿ã™ã‚‹âœï¸</span>
		    </a>
		</div>
	</div>
	</div>
	</body>
	<!--Bootstrap JS-->
	<script src = "https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
	<!--ê²€ìƒ‰ ê¸°ëŠ¥ ìŠ¤í¬ë¦½íŠ¸ ì¶”ê°€-->
	<script>
		const searchIcon = document.getElementById('searchIcon');
		const searchBar = document.getElementById('searchBar');
		const searchInput = document.getElementById('searchInput');
		const closeSearch = document.getElementById('closeSearch');
		const searchButton = document.getElementById('searchButton');
		
		searchIcon.addEventListener('click', function(){
			searchBar.style.display = 'block';
			searchInput.focus();
		});
		
		closeSearch.addEventListener('click', function(){
			searchBar.style.display = 'none';
			searchInput.value = '';
		});
		
		searchButton.addEventListener('click', function(){
			performSearch();
		});
		
		searchInput.addEventListener('keypress', function(){
			if(e.key === 'Enter'){
				performSearch();
			}
		});
		
		function performSearch(){
			const keyword = searchInput.value.trim(); 
			
			if(keyword === ''){
				alert('æ¤œç´¢ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
				return;
			}
			    // ê²€ìƒ‰ í˜ì´ì§€ë¡œ ì´ë™ (GET ë°©ì‹)
			    location.href = '/board/search?keyword=' + encodeURIComponent(keyword);
			}
			const regionData = {
			        'åŒ—æµ·é“ãƒ»æ±åŒ—': ['åŒ—æµ·é“', 'é’æ£®çœŒ', 'å²©æ‰‹çœŒ', 'å®®åŸçœŒ', 'ç§‹ç”°çœŒ', 'å±±å½¢çœŒ', 'ç¦å³¶çœŒ'],
			        'é–¢æ±': ['æ±äº¬éƒ½', 'ç¥å¥ˆå·çœŒ', 'åƒè‘‰çœŒ', 'åŸ¼ç‰çœŒ', 'èŒ¨åŸçœŒ', 'æ ƒæœ¨çœŒ', 'ç¾¤é¦¬çœŒ'],
			        'ä¸­éƒ¨': ['æ„›çŸ¥çœŒ', 'é™å²¡çœŒ', 'å²é˜œçœŒ', 'ä¸‰é‡çœŒ', 'æ–°æ½ŸçœŒ', 'å¯Œå±±çœŒ', 'çŸ³å·çœŒ', 'ç¦äº•çœŒ', 'å±±æ¢¨çœŒ', 'é•·é‡çœŒ'],
			        'è¿‘ç•¿': ['å¤§é˜ªåºœ', 'å…µåº«çœŒ', 'äº¬éƒ½åºœ', 'æ»‹è³€çœŒ', 'å¥ˆè‰¯çœŒ', 'å’Œæ­Œå±±çœŒ'],
			        'ä¸­å›½ãƒ»å››êµ­': ['é³¥å–çœŒ', 'å³¶æ ¹çœŒ', 'å²¡å±±çœŒ', 'åºƒå³¶çœŒ', 'å±±å£çœŒ', 'å¾³å³¶çœŒ', 'é¦™å·çœŒ', 'æ„›åª›çœŒ', 'é«˜çŸ¥çœŒ'],
			        'ä¹å·ãƒ»æ²–ç¸„': ['ç¦å²¡çœŒ', 'ä½è³€çœŒ', 'é•·å´çœŒ', 'ç†Šæœ¬çœŒ', 'å¤§åˆ†çœŒ', 'å®®å´çœŒ', 'é¹¿å…å³¶çœŒ', 'æ²–ç¸„çœŒ']
			    };
				const regionDropdown = document.getElementById('regionDropdown');
				const categoryDisplay = document.getElementById('categoryDisplay');
					
				if (regionDropdown) {
				        Object.keys(regionData).forEach(region => {
				            const li = document.createElement('li');
				            li.className = 'dropdown-submenu position-relative';
							
							const prefecturesHtml = regionData[region].map(pref => 
							                `<li><a class="dropdown-item ps-4" href="#" onclick="selectCategory('${pref}')">${pref}</a></li>`
							            ).join('');

										li.innerHTML = `
										    <a class="dropdown-item dropdown-toggle" href="#" onclick="selectCategory('${region}')">${region}</a>
										    <ul class="dropdown-menu start-100 top-0 shadow">
										        ${prefecturesHtml}
										    </ul>
										`;
							            regionDropdown.appendChild(li);
							        });
							    }
								window.selectCategory = function(name) {
								        if (categoryDisplay) {
								            categoryDisplay.textContent = name;
								        }

										    // ã™ã¹ã¦ ì„ íƒ ì‹œ
										    if (name === 'ã™ã¹ã¦') {
										        location.href = '/board';
										    }
										    // ì§€ë°© ì„ íƒ ì‹œ (åŒ—æµ·é“ãƒ»æ±åŒ—, é–¢æ± ë“±)
										    else if (['åŒ—æµ·é“ãƒ»æ±åŒ—', 'é–¢æ±', 'ä¸­éƒ¨', 'è¿‘ç•¿', 'ä¸­å›½ãƒ»å››å›½', 'ä¹å·ãƒ»æ²–ç¸„'].includes(name)) {
										        location.href = '/board?region=' + encodeURIComponent(name);
										    }
										    // ë„ë„ë¶€í˜„ ì„ íƒ ì‹œ
										    else {
										        location.href = '/board?prefecture=' + encodeURIComponent(name);
										    }
										};
	</script>
		



</html>